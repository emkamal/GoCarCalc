<!DOCTYPE html>
<html>

<head>
    <title>GoCar Profit Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🤑</text></svg>">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap-dark.min.css">
    <link href="style.css" rel="stylesheet" type="text/css">
</head>

<body class="bg-dark text-light">
    <nav class="navbar fixed-top navbar-dark bg-primary">
        <a class="navbar-brand" href="#">
            GoCar Profit Calculator
        </a>
        <h4 class="navbar-text">🚗</h4>
    </nav>
    <form id="mainForm">
        <div class="row">
            <div class="col col-md-12">
              <div class="form-group">
                <label for="gopay-revenue">Gopay Revenue (Rp):</label>
                <input type="number" id="gopay-revenue" name="gopay-revenue" class="form-control" placeholder="e.g 250000">
              </div>
            </div>
          </div>
        <div class="row">
            <div class="col col-md-12">
              <div class="form-group">
                <label for="cash-revenue">Cash Revenue (Rp):</label>
                <input type="number" id="cash-revenue" name="cash-revenue" class="form-control" placeholder="e.g 150000">
              </div>
            </div>
          </div>
        <div class="row">
            <div class="col col-md-12">
                <div class="form-group">
                    <label for="kept-deposit">Kept Deposit (Rp):</label>
                    <input type="number" id="kept-deposit" name="kept-deposit" class="form-control disabledByDefault"
                        placeholder="e.g 10000" disabled>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col col-md-12">
                <div class="form-group">
                    <label for="distance-travelled">Distance Travelled (KM):</label>
                    <input type="number" id="distance-travelled" name="distance-travelled" class="form-control"
                        placeholder="e.g 165">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col col-md-12">
                <div class="form-group">
                    <label for="average-fuel-consumption">Average Fuel Consumption (KM/L):</label>
                    <input type="number" id="average-fuel-consumption" name="average-fuel-consumption"
                        class="form-control" placeholder="e.g 11.6">
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col col-md-6">
                <div class="form-group">
                    <label for="parking-expense">Parking Expense:</label>
                    <input type="number" id="parking-expense" name="parking-expense" class="form-control"
                        placeholder="e.g 10000">
                </div>
            </div>
            <div class="col col-md-6">
                <div class="form-group">
                    <label for="toll-expense">Toll Expense:</label>
                    <input type="number" id="toll-expense" name="toll-expense" class="form-control"
                        placeholder="e.g 5000">
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col col-md-12">
                <div class="form-group">
                    <label for="fuel-price">Fuel Price (Rp):</label>
                    <input type="number" id="fuel-price" name="fuel-price" value="10000"
                        class="form-control disabledByDefault" disabled>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col col-md-12">
                <div class="form-group">
                    <label for="car-maintenance-cost">Car Maintenance Cost (%):</label>
                    <input type="number" id="car-maintenance-cost" name="car-maintenance-cost" value="10"
                        class="form-control disabledByDefault" disabled>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col col-md-12">
                <div class="row">
                    <div class="col col-md-6">
                        <div class="form-group">
                            <label for="car-owner-share">Car Owner Share (%):</label>
                            <input type="number" id="car-owner-share" name="car-owner-share" value="50"
                                class="form-control disabledByDefault" disabled>
                        </div>
                    </div>
                    <div class="col col-md-6">
                        <div class="form-group">
                            <label for="car-driver-share">Car Driver Share (%):</label>
                            <input type="number" id="car-driver-share" name="car-driver-share" value="50"
                                class="form-control disabledByDefault" disabled>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col col-md-12">
                <div class="form-group row">
                    <div class="col col-md-12 text-right">
                        <div class="form-group">
                            <label for="unlock">
                                <input type="checkbox" id="unlock" name="unlock" onclick="unlockFields()"> Unlock all
                                fields
                            </label>
                            <label for="hide">
                                <input type="checkbox" id="hide" name="hide" onclick="hideDisabledFields()" checked>
                                Hide disabled fields
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="fixed-bottom bottomBar">
            <div class="container-fluid">
                <div class="row">
                    <div class="col col-md-12">
                        <div class="form-group">
                            <input type="button" class="btn btn-primary" value="Calculate" onclick="calculateProfit()">
                            <input id="secButton" type="button" class="btn btn-secondary" value="Load sample"
                                onclick="LoadSample()">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <br>
    <div id="result"></div>

    <script>
        function calculateProfit() {
            var gopayRevenue = parseFloat(document.getElementById("gopay-revenue").value);
            var cashRevenue = parseFloat(document.getElementById("cash-revenue").value) || 0;
            var keptDeposit = parseFloat(document.getElementById("kept-deposit").value) || 0;
            var distanceTravelled = parseFloat(document.getElementById("distance-travelled").value);
            var averageFuelConsumption = parseFloat(document.getElementById("average-fuel-consumption").value);
            var parkingExpense = parseFloat(document.getElementById("parking-expense").value) || 0;
            var tollExpense = parseFloat(document.getElementById("toll-expense").value) || 0;
            var fuelPrice = parseFloat(document.getElementById("fuel-price").value);
            var carMaintenanceCost = parseFloat(document.getElementById("car-maintenance-cost").value);
            var ownerShare = parseFloat(document.getElementById("car-owner-share").value);
            var driverShare = parseFloat(document.getElementById("car-driver-share").value);

            if (isNaN(gopayRevenue) || isNaN(distanceTravelled) || isNaN(averageFuelConsumption)) {
                document.getElementById("result").innerHTML = "<div class='alert alert-danger'>Please fill all the fields with valid numbers</div>";
                if (isNaN(gopayRevenue)) {
                    document.getElementById("gopay-revenue").classList.add("is-invalid");
                } else {
                    document.getElementById("gopay-revenue").classList.remove("is-invalid");
                }
                if (isNaN(distanceTravelled)) {
                    document.getElementById("distance-travelled").classList.add("is-invalid");
                } else {
                    document.getElementById("distance-travelled").classList.remove("is-invalid");
                }
                if (isNaN(averageFuelConsumption)) {
                    document.getElementById("average-fuel-consumption").classList.add("is-invalid");
                } else {
                    document.getElementById("average-fuel-consumption").classList.remove("is-invalid");
                }
                return;
            }

            var grossRevenue = gopayRevenue + cashRevenue;

            var fuelCost = distanceTravelled / averageFuelConsumption * fuelPrice;
            var grossIncome = grossRevenue - fuelCost - keptDeposit - parkingExpense - tollExpense;
            var maintenanceCost = (grossIncome * carMaintenanceCost) / 100;
            var netIncome = grossIncome - maintenanceCost;
            var fundsOnPocket = gopayRevenue - fuelCost - keptDeposit - maintenanceCost;
            var ownerIncome = (netIncome * ownerShare) / 100;
            var driverIncome = (netIncome * driverShare) / 100;

            var transferToOwnerFromPocket = 0;
            var transferToDriverFromPocket = 0;
            var transferToOwnerFromCash = 0;
            var transferToDriverFromCash = 0;

            if(ownerIncome < fundsOnPocket) {
                transferToOwnerFromPocket = ownerIncome;
                transferToOwnerFromCash = 0;
                transferToDriverFromPocket = fundsOnPocket - ownerIncome;
                transferToDriverFromCash = driverIncome - transferToDriverFromPocket;
            } else {
                transferToOwnerFromPocket = fundsOnPocket;
                transferToOwnerFromCash = ownerIncome - fundsOnPocket;
                transferToDriverFromPocket = 0;
                transferToDriverFromCash = driverIncome;
            }

            const table = document.createElement("table");
            table.classList.add("table");
            table.classList.add("table-dark");

            const thead = document.createElement("thead");
            const tr = document.createElement("tr");

            const th1 = document.createElement("th");
            th1.textContent = "Account";

            const th2 = document.createElement("th");
            th2.textContent = "Amount (Rp)";

            tr.appendChild(th1);
            tr.appendChild(th2);
            thead.appendChild(tr);
            table.appendChild(thead);

            const tbody = document.createElement("tbody");

            addRow(tbody, "💰 Gross Revenue", "Rp", addThousandSeparator(grossRevenue));
            addRow(tbody, "⛽ Fuel Cost", "Rp", addThousandSeparator(fuelCost));
            addRow(tbody, "💸 Gross Income", "Rp", addThousandSeparator(grossIncome));
            addRow(tbody, "🛠️ Maintenance Cost", "Rp", addThousandSeparator(maintenanceCost));
            addRow(tbody, "🤑 Net Income", "Rp", addThousandSeparator(netIncome), ["bg-success", "mainInfoRow"]);
            addRow(tbody, "🏧 Funds on Pocket", "Rp", addThousandSeparator(fundsOnPocket), []);

            table.appendChild(tbody);

            // create another table
            const table2 = document.createElement("table");
            table2.classList.add("table");
            table2.classList.add("table-dark");

            // create thead with 2 columns, first one is Owner, second one is Driver
            const thead2 = document.createElement("thead");
            const tr2 = document.createElement("tr");
            const th20 = document.createElement("th");
            th20.textContent = "";
            const th21 = document.createElement("th");
            th21.textContent = "Owner";
            const th22 = document.createElement("th");
            th22.textContent = "Driver";
            tr2.appendChild(th20);
            tr2.appendChild(th21);
            tr2.appendChild(th22);
            thead2.appendChild(tr2);
            table2.appendChild(thead2);

            // create tbody with 2 columns, first one is Transfer to Owner, second one is Transfer to Driver
            const tbody2 = document.createElement("tbody");
            // create row with 3 columns, the first column says "Income", the second column contain Owner income, the third column contain Driver income
            const tr20 = document.createElement("tr");
            tr20.classList.add("bg-primary", "mainInfoRow");
            const td20 = document.createElement("td");
            td20.textContent = "Income";
            const td21 = document.createElement("td");
            td21.textContent = addThousandSeparator(ownerIncome);
            const td22 = document.createElement("td");
            td22.textContent = addThousandSeparator(driverIncome);
            tr20.appendChild(td20);
            tr20.appendChild(td21);
            tr20.appendChild(td22);
            tbody2.appendChild(tr20);

            const tr21 = document.createElement("tr");
            tr21.classList.add("mainInfoRow");
            const td211 = document.createElement("td");
            td211.textContent = "Transfer to";
            td211.colSpan = 3;
            const tr22 = document.createElement("tr");
            const td221 = document.createElement("td");
            td221.textContent = "From pocket";
            const td222 = document.createElement("td");
            td222.textContent = addThousandSeparator(transferToOwnerFromPocket);
            const td223 = document.createElement("td");
            td223.textContent = addThousandSeparator(transferToDriverFromPocket);
            const tr23 = document.createElement("tr");
            const td231 = document.createElement("td");
            td231.textContent = "From cash";
            const td232 = document.createElement("td");
            td232.textContent = addThousandSeparator(transferToOwnerFromCash);
            const td233 = document.createElement("td");
            td233.textContent = addThousandSeparator(transferToDriverFromCash);
            tr21.appendChild(td211);
            tr22.appendChild(td221);
            tr22.appendChild(td222);
            tr22.appendChild(td223);
            tr23.appendChild(td231);
            tr23.appendChild(td232);
            tr23.appendChild(td233);
            tbody2.appendChild(tr21);
            tbody2.appendChild(tr22);
            tbody2.appendChild(tr23);

            table2.appendChild(tbody2);


            document.getElementById("result").innerHTML = "";
            document.getElementById("result").appendChild(table);
            document.getElementById("result").appendChild(table2);
            document.getElementById("result").style.opacity = 1;
            document.getElementById("result").scrollIntoView({ behavior: "smooth" });

            // create a button element with class btn and btn-primary and text "Save Data", the action should be to store all the data above to a local file using File API
            const saveButton = document.createElement("button");
            saveButton.classList.add("btn");
            saveButton.classList.add("btn-primary");
            saveButton.textContent = "Save Data";
            saveButton.addEventListener("click", function () {
                const data = {
                    grossRevenue: grossRevenue,
                    distanceTravelled: distanceTravelled,
                    averageFuelConsumption: averageFuelConsumption,
                    parkingExpense: parkingExpense,
                    tollExpense: tollExpense,
                    fuelPrice: fuelPrice,
                    carMaintenanceCost: carMaintenanceCost,
                    ownerShare: ownerShare,
                    driverShare: driverShare
                };

                saveDataToFile(data);
                // const blob = new Blob([JSON.stringify(data)], { type: "application/json" });
                // const url = URL.createObjectURL(blob);
                // const a = document.createElement("a");
                // a.href = url;
                // a.download = "data.json";
                // a.click();
            });
            // document.getElementById("result").appendChild(saveButton);
        }

        function saveDataToFile(data) {
            var file = new File([data], "data.txt", { type: "text/plain" });
            var writer = new FileWriter();

            writer.onwriteend = function () {
                console.log("Data saved to file.");
            };

            writer.onerror = function () {
                console.error("Error saving data to file.");
            };

            writer.write(file);
        }

        function addThousandSeparator(num) {
            num = Math.round(num);
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function addRow(tbody, name, unit, value, className) {
            const row = document.createElement("tr");
            if (className) {
                if (typeof className === "string") {
                    className = [className];
                }
                className.forEach(function (className) {
                    row.classList.add(className);
                });
            }
            const rowtd1 = document.createElement("td");
            rowtd1.textContent = name;
            const rowtd2 = document.createElement("td");
            rowtd2.classList.add("text-right");
            rowtd2.textContent = unit + " " + value;
            row.appendChild(rowtd1);
            row.appendChild(rowtd2);
            tbody.appendChild(row);
        }

        function LoadSample() {
            document.getElementById("gopay-revenue").value = 250000;
            document.getElementById("cash-revenue").value = 150000;
            document.getElementById("distance-travelled").value = 200;
            document.getElementById("average-fuel-consumption").value = 10;
            calculateProfit();
            monitorFields();
        }
        function clear() {
            var enabledFields = document.querySelectorAll('input[type="number"]:not(.disabledByDefault)');
            enabledFields.forEach(function (field) {
                field.value = "";
                field.classList.remove("is-invalid");
            });
            const result = document.getElementById("result");
            result.style.opacity = 1;

            const fadeEffect = setInterval(function () {
                if (result.style.opacity > 0) {
                    result.style.opacity -= 0.1;
                } else {
                    clearInterval(fadeEffect);
                    result.innerHTML = "";
                }
            }, 50);
            monitorFields();
            document.documentElement.scrollIntoView({ behavior: "smooth" });

        }
        function unlockFields() {
            var inputs = document.querySelectorAll('input.disabledByDefault');
            for (var i = 0; i < inputs.length; i++) {
                if (inputs[i].disabled) {
                    inputs[i].disabled = false;
                } else {
                    inputs[i].disabled = true;
                }
            }
        }
        function hideDisabledFields() {
            if (document.getElementById("hide").checked == true) {
                // Get all disabled fields
                var disabledFields = document.querySelectorAll('input:disabled');

                // Loop through each disabled field
                for (var i = 0; i < disabledFields.length; i++) {
                    // Find the closest parent element with class "row"
                    var row = disabledFields[i].closest('.row');

                    // Hide the row
                    if (row) {
                        row.style.display = "none";
                    }
                }
            } else {
                // Get all rows that were previously hidden
                var hiddenRows = document.querySelectorAll('.row[style="display: none;"]');

                // Loop through each hidden row
                for (var i = 0; i < hiddenRows.length; i++) {
                    // Show the row
                    hiddenRows[i].style.display = "flex";
                }
            }
        }
        hideDisabledFields();

        function monitorFields() {
            var enabledFields = document.querySelectorAll('input[type="number"]:not(.disabledByDefault)');
            var button = document.getElementById("secButton");

            // loop through all enabled fields
            for (var i = 0; i < enabledFields.length; i++) {
                // if any of the enabled fields are not empty, change the button to "Clear"
                if (enabledFields[i].value !== "") {
                    button.value = "Clear";
                    button.onclick = clear;
                    return;
                }
            }

            button.value = "Load Sample";
            button.onclick = LoadSample;
        }

        // Call the monitorFields function whenever the value of an enabled field changes
        document.querySelectorAll('input:not(.disabledByDefault)').forEach(function (field) {
            field.addEventListener("change", monitorFields);
        });

        // add keyup event listener to all fields where if the user press ctrl+enter, the calculateProfit function will be called
        document.querySelectorAll('input[type="number"]').forEach(function (field) {
            field.addEventListener("keyup", function (event) {
                if (event.ctrlKey && event.key === "Enter") {
                    calculateProfit();
                }
            });
        });

    </script>
</body>

</html>